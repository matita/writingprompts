function RedditFlow(a){var b,c=this,d="https://reddit.com/"+a+".json?jsonp=?",e=!1;c.older=function(a){e||(e=!0,$.getJSON(d,{after:b},function(c){e=!1,c.data&&(b=c.data.after),a(c)}))}}$(function(){function a(){if(!$(document.body).is(".viewing-stories")){var a=$(this),b=a.attr("data-link").substr(1),c=new RedditFlow(b);a.addClass("selected"),$(document.body).addClass("viewing-stories"),c.older(function(a){var c=a[1].data.children.map(function(a){var c=a.data;return console.debug("data",c),c.permalink=b+c.id,c});console.debug("comments",c);var d=c.map(Tmpl.story).join("");$(".stories").html(d)})}}var b=new RedditFlow("r/WritingPrompts");b.older(function(a){var b=a.data.children.map(function(a){return a.data}),c=b.map(Tmpl.prompt).join("");$(".prompts").html(c)}),$("body").on("click",".prompt",a).on("click",".back-to-prompts",function(a){console.debug($("body").removeClass("viewing-stories")),a.stopPropagation()})}),Handlebars.registerHelper("unescape",function(a){return $("<p>").html(a).text()}),Handlebars.registerHelper("readspeed",function(a){var b=a&&Math.round(a.length/5)||0,c=250;return moment.duration(b/c,"minutes").humanize()}),Handlebars.registerHelper("fromNow",function(a){var b=a.created_utc+moment().zone();return moment(1e3*b).fromNow()}),Handlebars.registerHelper("dateFormat",function(a){var b=a.created_utc+moment().zone();return moment(1e3*b).format()}),this.Tmpl=this.Tmpl||{},this.Tmpl.prompt=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f,g="function",h=b.helperMissing,i=this.escapeExpression,j='<section class="prompt" data-link="'+i((f=null!=(f=b.permalink||(null!=a?a.permalink:a))?f:h,typeof f===g?f.call(a,{name:"permalink",hash:{},data:d}):f))+'" id="prompt-'+i((f=null!=(f=b.id||(null!=a?a.id:a))?f:h,typeof f===g?f.call(a,{name:"id",hash:{},data:d}):f))+'">\r\n	<a href="#prompt-'+i((f=null!=(f=b.id||(null!=a?a.id:a))?f:h,typeof f===g?f.call(a,{name:"id",hash:{},data:d}):f))+'" class="back-to-prompts">back</a>\r\n\r\n	<h3 class="prompt-title">';return f=null!=(f=b.title||(null!=a?a.title:a))?f:h,e=typeof f===g?f.call(a,{name:"title",hash:{},data:d}):f,null!=e&&(j+=e),j+'</h3>\r\n\r\n	<a href="http://reddit.com/'+i((f=null!=(f=b.permalink||(null!=a?a.permalink:a))?f:h,typeof f===g?f.call(a,{name:"permalink",hash:{},data:d}):f))+'" target="_blank">\r\n		<time datetime="'+i((b.dateFormat||a&&a.dateFormat||h).call(a,a,{name:"dateFormat",hash:{},data:d}))+'">\r\n			'+i((b.fromNow||a&&a.fromNow||h).call(a,a,{name:"fromNow",hash:{},data:d}))+"\r\n		</time>\r\n	</a>\r\n</section>"},useData:!0}),this.Tmpl.story=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f,g="function",h=b.helperMissing,i=this.escapeExpression,j=this.lambda,k='<article class="story">\r\n	<header>\r\n		<h2 class="story-author">\r\n			<span class="h2-span">'+i((f=null!=(f=b.author||(null!=a?a.author:a))?f:h,typeof f===g?f.call(a,{name:"author",hash:{},data:d}):f))+'</span>\r\n		</h2>\r\n		<span class="story-score">'+i((f=null!=(f=b.score||(null!=a?a.score:a))?f:h,typeof f===g?f.call(a,{name:"score",hash:{},data:d}):f))+' points</span>\r\n		<span class="story-reading-time">'+i((b.readspeed||a&&a.readspeed||h).call(a,null!=a?a.body:a,{name:"readspeed",hash:{},data:d}))+"</span>\r\n	</header>\r\n	\r\n	";return e=(b.unescape||a&&a.unescape||h).call(a,null!=a?a.body_html:a,{name:"unescape",hash:{},data:d}),null!=e&&(k+=e),k+'\r\n\r\n	<footer>\r\n		<a href="http://reddit.com/'+i((f=null!=(f=b.permalink||(null!=a?a.permalink:a))?f:h,typeof f===g?f.call(a,{name:"permalink",hash:{},data:d}):f))+'" target="_blank">\r\n			'+i(j(null!=(e=null!=(e=null!=(e=null!=a?a.replies:a)?e.data:e)?e.children:e)?e.length:e,a))+" replies\r\n		</a>\r\n	</footer>\r\n</article>"},useData:!0});