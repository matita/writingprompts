function plugin(a,b){Read.plugins[a]=b}function applyPlugins(a,b){b.forEach(function(b){var c=Read.plugins[b];c&&(a.rendered_html=c(a))})}function RedditFlow(a){var b,c=this,d="https://reddit.com/"+a.split("?").map(function(a,b,c){return 0===b?a+".json"+(1==c.length?"?jsonp=?":""):1==b?"jsonp=?&"+a:a}).join("?"),e=!1;c.older=function(a){return e?void 0:(e=!0,$.getJSON(d,{after:b},function(c){e=!1,c.data&&(b=c.data.after),a(c)}),c)},c.after=function(a){return a?(b=a,c):b}}function Comments(a){var b=new RedditFlow(a);$(document.body).scrollTop(0).addClass("viewing-stories"),$(".prompts").html("Loading stories..."),b.older(function(a){var b=a[0].data.children[0].data,c=a[1].data.children.map(function(a){var c=a.data;return c.url=b.url+c.id,applyPlugins(c,Read.commentPlugins),c.rendered_text=$("<div>").html(c.rendered_html).text(),c});applyPlugins(b,Read.commentPlugins);var d=Tmpl.prompt(b)+c.map(Tmpl.story).join("");$(".prompts").html(d)})}function Posts(a){function b(){d.append(e),f.remove(),c.older(function(a){e.remove();var g=a.data.children.map(function(a){return a.data}),h=g.map(Tmpl.prompt).join("");d.append(h),c.after()&&d.append(f.click(b))})}var c=new RedditFlow(a),d=$(".prompts"),e=$('<div class="loader">Loading...</div>'),f=$('<button class="more">More</button>');$(document.body).scrollTop(0).removeClass("viewing-stories"),d.html(""),b()}var Read={plugins:{},commentPlugins:["recursePosts","unescape","markEdits","embedImages"]};$(function(){function a(){var a=c();a.postsSort&&$(".posts-sort").val(a.postsSort),b()}function b(){location.search.substr(1)||history.replaceState(null,"","?r/WritingPrompts");var a=c(),b=a.postsSort,d=location.search.substr(1),e=d.match(/\/?(r|u(ser)?)\/(\w+)/),f="/"+e[1]+"/"+e[3];b&&(d=d.replace(/\/?r\/(\w+)(\/?(hot|new|rising|controversial|top|gilded)?)$/,"/r/$1/"+b)),d.match(/\/comments\//)?Comments(d):Posts(d,b),f&&($(".sub-link").attr("href","?"+f),$(".sub-title").html(f)),d.match(/^\/?r\/\w+(\/(hot|new|rising|controversial|top|gilded))?(\?|$)/)?$(".sorting").show():$(".sorting").hide()}function c(a){return a?void localStorage.setItem("r_settings",JSON.stringify(a||{})):JSON.parse(localStorage.getItem("r_settings")||"{}")}$("body").on("click","a:not(.external-link)",function(){var a=$(this).attr("href").replace(/^https?:\/\/(www\.)?reddit\.com\//,"?");return a.match(/^http/)?void 0:(a.match(/^\?/)||(a="?"+a),history.pushState(null,"",a),b(),!1)}).on("change",".posts-sort",function(){var a=c(),d=""+$(this).val();a.postsSort=d,c(a),b()}),$(window).on("popstate",b),a()}),plugin("embedImages",function(a){return $("<div>").html(a.rendered_html).find("a").each(function(){var a=$(this),b=a.attr("href"),c=b.match(/https?:\/\/(i\.)?imgur\.com\/(\w+)(\.(jpe?g|png|gifv?))?/);c&&(console.debug("^ this is img"),a.attr("title",a.text()).html('<figure><img src="//i.imgur.com/'+c[2]+'m.jpg"><figcaption>'+a.text()+"</figcaption></figure>"))}).end().html()}),plugin("markEdits",function(a){return $("<div>").html(a.rendered_html).find("p").each(function(){var a=$(this),b=a.text();b.match(/^edit(ed)?\b/i)&&a.addClass("edit-note")}).end().html()}),plugin("recursePosts",function(a){function b(a,d){a.author==d&&(c.push(a.body_html||a.selftext_html),a.replies&&a.replies.data&&a.replies.data.children&&a.replies.data.children.forEach(function(c){b(c.data,a.author)}))}var c=[];return b(a,a.author),c.join("\n")}),plugin("unescape",function(a){return $("<div>").html(a.rendered_html).text()}),Handlebars.registerHelper("unescape",function(a){return $("<p>").html(a).text()}),Handlebars.registerHelper("readspeed",function(a){var b=a&&Math.round(a.length/5)||0,c=250;return moment.duration(b/c,"minutes").humanize()}),Handlebars.registerHelper("fromNow",function(a){var b=a.created_utc+moment().zone();return moment(1e3*b).fromNow()}),Handlebars.registerHelper("dateFormat",function(a){var b=a.created_utc+moment().zone();return moment(1e3*b).format()}),this.Tmpl=this.Tmpl||{},this.Tmpl.prompt=Handlebars.template({1:function(a,b,c,d){var e=b.helperMissing,f=this.escapeExpression;return f((b.readspeed||a&&a.readspeed||e).call(a,null!=a?a.selftext:a,{name:"readspeed",hash:{},data:d}))},3:function(a,b,c,d){var e=b.helperMissing,f=this.escapeExpression;return f((b.readspeed||a&&a.readspeed||e).call(a,null!=a?a.body:a,{name:"readspeed",hash:{},data:d}))},5:function(a,b,c,d){var e,f,g="function",h=b.helperMissing,i=this.escapeExpression,j='	<a href="?r/'+i((f=null!=(f=b.subreddit||(null!=a?a.subreddit:a))?f:h,typeof f===g?f.call(a,{name:"subreddit",hash:{},data:d}):f))+"/comments/"+i((f=null!=(f=b.id||(null!=a?a.id:a))?f:h,typeof f===g?f.call(a,{name:"id",hash:{},data:d}):f))+'">\r\n		<h3 class="prompt-title" title="';return f=null!=(f=b.title||(null!=a?a.title:a))?f:h,e=typeof f===g?f.call(a,{name:"title",hash:{},data:d}):f,null!=e&&(j+=e),j+='">',f=null!=(f=b.title||(null!=a?a.title:a))?f:h,e=typeof f===g?f.call(a,{name:"title",hash:{},data:d}):f,null!=e&&(j+=e),j+"</h3>\r\n	</a>\r\n"},7:function(a,b,c,d){var e,f,g="function",h=b.helperMissing,i=this.escapeExpression,j='	<a href="'+i((f=null!=(f=b.link_url||(null!=a?a.link_url:a))?f:h,typeof f===g?f.call(a,{name:"link_url",hash:{},data:d}):f))+i((f=null!=(f=b.id||(null!=a?a.id:a))?f:h,typeof f===g?f.call(a,{name:"id",hash:{},data:d}):f))+'">\r\n		<h3 class="prompt-title" title="';return f=null!=(f=b.link_title||(null!=a?a.link_title:a))?f:h,e=typeof f===g?f.call(a,{name:"link_title",hash:{},data:d}):f,null!=e&&(j+=e),j+='">',f=null!=(f=b.link_title||(null!=a?a.link_title:a))?f:h,e=typeof f===g?f.call(a,{name:"link_title",hash:{},data:d}):f,null!=e&&(j+=e),j+"</h3>\r\n	</a>\r\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f,g="function",h=b.helperMissing,i=this.escapeExpression,j='<article class="prompt" data-link="'+i((f=null!=(f=b.permalink||(null!=a?a.permalink:a))?f:h,typeof f===g?f.call(a,{name:"permalink",hash:{},data:d}):f))+'" id="prompt-'+i((f=null!=(f=b.id||(null!=a?a.id:a))?f:h,typeof f===g?f.call(a,{name:"id",hash:{},data:d}):f))+'">\r\n	<a href="?r/'+i((f=null!=(f=b.subreddit||(null!=a?a.subreddit:a))?f:h,typeof f===g?f.call(a,{name:"subreddit",hash:{},data:d}):f))+'" class="back-to-prompts">&#8592; back to prompts</a>\r\n\r\n	<header class="prompt-header">\r\n		<h2 class="story-author">\r\n			<span class="h2-span">'+i((f=null!=(f=b.author||(null!=a?a.author:a))?f:h,typeof f===g?f.call(a,{name:"author",hash:{},data:d}):f))+'</span>\r\n		</h2>\r\n		<span class="story-score">'+i((f=null!=(f=b.score||(null!=a?a.score:a))?f:h,typeof f===g?f.call(a,{name:"score",hash:{},data:d}):f))+' points</span>\r\n		<span class="story-reading-time">\r\n			';return e=b["if"].call(a,null!=a?a.title:a,{name:"if",hash:{},fn:this.program(1,d),inverse:this.noop,data:d}),null!=e&&(j+=e),j+="\r\n			",e=b["if"].call(a,null!=a?a.body:a,{name:"if",hash:{},fn:this.program(3,d),inverse:this.noop,data:d}),null!=e&&(j+=e),j+="\r\n			read\r\n		</span>\r\n	</header>\r\n\r\n",e=b["if"].call(a,null!=a?a.title:a,{name:"if",hash:{},fn:this.program(5,d),inverse:this.noop,data:d}),null!=e&&(j+=e),j+="\r\n",e=b["if"].call(a,null!=a?a.link_title:a,{name:"if",hash:{},fn:this.program(7,d),inverse:this.noop,data:d}),null!=e&&(j+=e),j+='\r\n	<div class="post-body">\r\n		',f=null!=(f=b.rendered_html||(null!=a?a.rendered_html:a))?f:h,e=typeof f===g?f.call(a,{name:"rendered_html",hash:{},data:d}):f,null!=e&&(j+=e),j+'\r\n	</div>\r\n\r\n	<footer class="prompt-footer">\r\n		<a href="http://reddit.com/r/'+i((f=null!=(f=b.subreddit||(null!=a?a.subreddit:a))?f:h,typeof f===g?f.call(a,{name:"subreddit",hash:{},data:d}):f))+"/comments/"+i((f=null!=(f=b.id||(null!=a?a.id:a))?f:h,typeof f===g?f.call(a,{name:"id",hash:{},data:d}):f))+'" class="read-on-reddit external-link just-viewing">Read on Reddit</a>\r\n		<span class="just-viewing">&middot;</span>\r\n		<span class="post-comments">'+i((f=null!=(f=b.num_comments||(null!=a?a.num_comments:a))?f:h,typeof f===g?f.call(a,{name:"num_comments",hash:{},data:d}):f))+" comments</span>\r\n		&middot;\r\n		"+i((b.fromNow||a&&a.fromNow||h).call(a,a,{name:"fromNow",hash:{},data:d}))+"\r\n	</footer>\r\n</article>"},useData:!0}),this.Tmpl.story=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f,g="function",h=b.helperMissing,i=this.escapeExpression,j=this.lambda,k='<article class="story">\r\n	<header>\r\n		<h2 class="story-author">\r\n			<span class="h2-span">'+i((f=null!=(f=b.author||(null!=a?a.author:a))?f:h,typeof f===g?f.call(a,{name:"author",hash:{},data:d}):f))+'</span>\r\n		</h2>\r\n		<span class="story-score">'+i((f=null!=(f=b.score||(null!=a?a.score:a))?f:h,typeof f===g?f.call(a,{name:"score",hash:{},data:d}):f))+' points</span>\r\n		<span class="story-reading-time">'+i((b.readspeed||a&&a.readspeed||h).call(a,null!=a?a.rendered_text:a,{name:"readspeed",hash:{},data:d}))+" read</span>\r\n	</header>\r\n	\r\n	";return f=null!=(f=b.rendered_html||(null!=a?a.rendered_html:a))?f:h,e=typeof f===g?f.call(a,{name:"rendered_html",hash:{},data:d}):f,null!=e&&(k+=e),k+'\r\n\r\n	<footer>\r\n		<a href="'+i((f=null!=(f=b.url||(null!=a?a.url:a))?f:h,typeof f===g?f.call(a,{name:"url",hash:{},data:d}):f))+'" class="external-link">\r\n			'+i(j(null!=(e=null!=(e=null!=(e=null!=a?a.replies:a)?e.data:e)?e.children:e)?e.length:e,a))+" replies\r\n		</a>\r\n		&middot;\r\n		"+i((b.fromNow||a&&a.fromNow||h).call(a,a,{name:"fromNow",hash:{},data:d}))+"\r\n	</footer>\r\n</article>"},useData:!0});
//# sourceMappingURL=app.min.js.map